<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>SMB116 - Rapport de TP n°3</title>
</head>
<body>
<h1>SMB116 - Rapport de TP n°3</h1>
<ul>
    <li>
        <a href="#auteur">Auteur</a>
    </li>
    <li>
        <a href="#réponses">Réponses</a>
    </li>
    <li>
        <a href="#demo">Démonstration</a>
    </li>
    <li>
        <a href="#source">Sources du projet, téléchargement</a>
    </li>
</ul>
<h2>
    <a name="auteur">Auteur</a>
</h2>
<hr />
<p>Nom : <span class="b">KRYSZTOF</span>
</p>
<p>Pr&eacute;nom : <span class="b">HUGO</span>
</p>
<p>Matricule : <span class="b">FOD_0G5DRUFU4L1</span>
</p>
<p>Email : hugo.krysztof.auditeur@lecnam.net</p>
<h2>
    <a name="réponses">Réponses aux questions</a>
</h2>
<hr />
<h3>Question 1.1 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    public class MainActivity extends ListActivity {
        private List < String > listeUE;

        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.liste_ue);

            this.listeUE = new ArrayList < String > ();
            listeUE.add("INA134");
            listeUE.add("SAE125");
            listeUE.add("MAA131");
            listeUE.add("ELE102");
            listeUE.add("ELA134");
            listeUE.add("ELE135");
            listeUE.add("INA136");
            listeUE.add("SAE126");
            listeUE.add("MAA136");
            listeUE.add("ELA136");
            listeUE.add("ELE137");

            setListAdapter(new ArrayAdapter < String > (this, android.R.layout.simple_list_item_1, listeUE));
      }
    </code>
</pre>
<br/>
<h4>liste_ue.xml</h4>
<pre>
    <xmp>
    <?xml version="1.0" encoding="utf-8"?>
    <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
                  android:layout_width="match_parent"
                  android:layout_height="match_parent"
                  android:orientation="vertical">

        <ListView
                android:id="@android:id/list"
                android:layout_width="match_parent"
                android:layout_height="match_parent" />

    </LinearLayout>
    </xmp>
</pre>
<br/>
<h3>Question 1.2 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    ...
        private EditText saisiUEEditTxt;

        protected void onCreate(Bundle savedInstanceState) {
        ...
            this.saisiUEEditTxt = findViewById(R.id.saisie_ue_edittxt);
        ...
        }
        public void onClickAjouterUE(View view){
            this.listeUE.add(saisiUEEditTxt.getText().toString());
            updateList();
        }
        private void updateList(){
            final ArrayAdapter adapter = ((ArrayAdapter)getListAdapter());
            runOnUiThread(new Runnable() {
                public void run() {
                    adapter.notifyDataSetChanged();
                }
            });
        }
    ...
    </code>
</pre>
<br/>
<h4>liste_ue.xml</h4>
<pre>
    <xmp>
    <?xml version="1.0" encoding="utf-8"?>
        <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
                      android:layout_width="match_parent"
                      android:layout_height="match_parent"
                      android:orientation="vertical">

            <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal">

                <Button
                        android:id="@+id/ajout_ue_btn"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:onClick="onClickAjouterUE"
                        android:text="@string/add_ue" />

                <EditText
                        android:id="@+id/saisie_ue_edittxt"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:ems="10"
                        android:hint="@string/saisie_hint"
                        android:inputType="textPersonName" />
            </LinearLayout>

            <ListView
                    android:id="@android:id/list"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent" />

        </LinearLayout>
    </xmp>
</pre>
<br/>
<h3>Question 1.3 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    ...
        @Override
        protected void onListItemClick(ListView l, View v, int position, long id) {
            super.onListItemClick(l, v, position, id);

            Intent intent = new Intent(this, SecondActivity.class);
            String str = getListView().getItemAtPosition(position).toString();
            intent.putExtra("ue", str);
            startActivity(intent);
        }
    ...
    </code>
</pre>
<br/>
<h4>SecondActivity.java</h4>
<pre>
    <code>
    public class SecondActivity extends Activity {
        String str;
        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            Intent intent = getIntent();
            this.str = intent.getStringExtra("ue");

            this.question3();
        }

        private void question3() {
            Toast.makeText(getApplicationContext(), str, Toast.LENGTH_LONG).show();
            finish();
        }
    }
    </code>
</pre>
<br/>
<h4>activity_second.xml</h4>
<pre>
    <xmp>
    <?xml version="1.0" encoding="utf-8"?>
    <androidx.constraintlayout.widget.ConstraintLayout
            xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent">

        <TextView
                android:id="@+id/textView"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:text="TextView"
                android:textSize="36sp" />

    </androidx.constraintlayout.widget.ConstraintLayout>
    </xmp>
</pre>
<br/>
<h3>Question 1.4 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    ...
        private static List< String > listeUE;
        //private List< String > listeUE;
    ...
        protected void onCreate(Bundle savedInstanceState) {
        ...
            //this.listeUE = new ArrayList< String >();
            //listeUE.add("INA134"); listeUE.add("SAE125"); listeUE.add("MAA131");
            //listeUE.add("ELE102"); listeUE.add("ELA134"); listeUE.add("ELE135");
            //listeUE.add("INA136"); listeUE.add("SAE126"); listeUE.add("MAA136");
            //listeUE.add("ELA136"); listeUE.add("ELE137");

            initializeList();
        ...
        }
    ...
        @Override
        protected void onResume() {
            super.onResume();

            Intent intent = getIntent();
            String ueToRemove = intent.getStringExtra("ueToRemove");
            if (ueToRemove != ""){
                this.listeUE.remove(ueToRemove);
                updateList();
            }
        }
        private void initializeList(){
            if (this.listeUE == null){
                this.listeUE = new ArrayList< String >();
                listeUE.add("INA134"); listeUE.add("SAE125"); listeUE.add("MAA131");
                listeUE.add("ELE102"); listeUE.add("ELA134"); listeUE.add("ELE135");
                listeUE.add("INA136"); listeUE.add("SAE126"); listeUE.add("MAA136");
                listeUE.add("ELA136"); listeUE.add("ELE137");
            }
        }
    ...
    </code>
</pre>
<br/>
<h4>SecondActivity.java</h4>
<pre>
    <code>
    public class SecondActivity extends Activity {
        String str;
        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            Intent intent = getIntent();
            this.str = intent.getStringExtra("ue");

            //this.question3();
            this.question4();
        }

        private void question4(){

            AlertDialog.Builder alertDialogBuilder = new AlertDialog.Builder(SecondActivity.this, R.style.Theme_AppCompat_Dialog_Alert);

            alertDialogBuilder.setTitle(R.string.remove_UE);

            alertDialogBuilder
                    .setMessage(R.string.remove_validation)
                    .setCancelable(false)
                    .setPositiveButton("Yes",new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int id) {
                            Intent intent = new Intent(SecondActivity.this, MainActivity.class);
                            intent.putExtra("ueToRemove", str);
                            startActivity(intent);
                        }
                    })
                    .setNegativeButton("No",new DialogInterface.OnClickListener() {
                        public void onClick(DialogInterface dialog, int id) {
                            finish();
                        }
                    });

            AlertDialog alertDialog = alertDialogBuilder.create();

            alertDialog.show();
        }
    }
    </code>
</pre>
<br/>
<h3>Question 1.5 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    ...
        //private static List< String > listeUE;
        private List< String > listeUE;
    ...
        protected void onCreate(Bundle savedInstanceState) {
        ...
            //this.listeUE = new ArrayList< String >();
            //listeUE.add("INA134"); listeUE.add("SAE125"); listeUE.add("MAA131");
            //listeUE.add("ELE102"); listeUE.add("ELA134"); listeUE.add("ELE135");
            //listeUE.add("INA136"); listeUE.add("SAE126"); listeUE.add("MAA136");
            //listeUE.add("ELA136"); listeUE.add("ELE137");

            //initializeList();
            loadListeUE();
        ...
        }
    ...
        @Override
        protected void onResume() {
            super.onResume();

            Intent intent = getIntent();
            String ueToRemove = intent.getStringExtra("ueToRemove");
            if (ueToRemove != ""){
                this.listeUE.remove(ueToRemove);
                saveListeUE();
                updateList();
            }
        }
        @Override
        protected void onDestroy() {
            super.onDestroy();
            saveListeUE();
        }
        private void saveListeUE(){
            SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
            SharedPreferences.Editor sEdit = prefs.edit();
            sEdit.putInt("listeUE_size",listeUE.size());
            for(int i = 0; i < listeUE.size(); i++){
                sEdit.putString("listeUE_"+i, listeUE.get(i));
            }
            sEdit.commit();
        }
        private void loadListeUE(){
            SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(this);
            int size = prefs.getInt("listeUE_size", -1);
            this.listeUE = new ArrayList< String >();
            if(size==-1){
                listeUE.add("INA134"); listeUE.add("SAE125"); listeUE.add("MAA131");
                listeUE.add("ELE102"); listeUE.add("ELA134"); listeUE.add("ELE135");
                listeUE.add("INA136"); listeUE.add("SAE126"); listeUE.add("MAA136");
                listeUE.add("ELA136"); listeUE.add("ELE137");
            }else{
                for(int i = 0; i < size; i++){
                    listeUE.add(prefs.getString("listeUE_"+i, "NULL"));
                }
            }
        //prefs.edit().clear();
        }
    ...
    </code>
</pre>
<br/>
<h3>Question 1.6 :</h3>
<h4>MainActivity.java</h4>
<pre>
    <code>
    ...
        protected void onCreate(Bundle savedInstanceState) {
        ...

            //setListAdapter(new ArrayAdapter< String >(this, android.R.layout.simple_list_item_1, listeUE));
            setListAdapter(new MyAdapter(this, android.R.layout.simple_list_item_1, listeUE));
        ...
        }
    ...
    </code>
</pre>
<br/>
<h4>MyAdapter.java</h4>
<pre>
    <code>
    public class MyAdapter extends ArrayAdapter< String > {

        static class ViewHolderItem {
            TextView textViewItem;
        }

        private static int compteur =0;
        private static int cacheCount=0;
        private static int outOfCacheCount=0;

        private Context mContext;
        private int mRessource;
        private List< String > listUE;

        public MyAdapter(@NonNull Context context, int resource, @NonNull List< String > objects) {
            super(context, resource, objects);

            this.mContext = context;
            this.mRessource = resource;
            this.listUE = objects;
        }

        @NonNull
        @Override
        public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {

            ViewHolderItem viewHolder;

            if(convertView==null){

                // inflate the layout
                LayoutInflater inflater = ((Activity) mContext).getLayoutInflater();
                convertView = inflater.inflate(mRessource, parent, false);

                // set up the ViewHolder
                viewHolder = new ViewHolderItem();
                viewHolder.textViewItem = (TextView) convertView.findViewById(android.R.id.text1);

                // store the holder with the view.
                convertView.setTag(viewHolder);

                MyAdapter.outOfCacheCount++;
                Log.i("compteur hors cache : ",MyAdapter.outOfCacheCount+"");

            }else{

                viewHolder = (ViewHolderItem) convertView.getTag();

                MyAdapter.cacheCount++;
                Log.i("compteur cache : ",MyAdapter.cacheCount+"");
            }


            viewHolder.textViewItem.setText(listUE.get(position));

            return convertView;
        }
    }
    </code>
</pre>
<br/>
<div>
    <h2>
        <a name="demo">Démonstration</a>
    </h2>
    <hr />
    <p>
        <img src="https://i.ibb.co/znHKVMF/TJCkivsx-QO.gif" />
    </p>
</div>
<div>
    <h2>
        <a name="source">Code-source et documentation</a>
    </h2>
    <hr />
    <ul>
        <li>
            <a href="https://github.com/Ashka59/SMB116-tp3">Code du projet en ligne</a>
        </li>
    </ul>
</div>
</body>
</html>